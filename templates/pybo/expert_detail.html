{% extends 'base.html' %}
{% block content %}
<div class="container col-sm-12 col-md-9 col-lg-9">

    <div class="container my-3">
        <!-- message 표시 -->
        {% if messages %}
        <div class="alert alert-danger my-3" role="alert">
            {% for message in messages %}
            <strong>{{ message.tags }}</strong>
            <ul>
                <li>{{ message.message }}</li>
            </ul>
            {% endfor %}
        </div>
        {% endif %}
        <!-- 질문 -->
        <h2 class="border-bottom py-2">{{ question.subject }}
            <span>
                <div style="font-size: 10px; display: flex; float: right; margin-top: 30px;">

                    <div>{{ question.modify_date }}</div>
                    <div>(수정됨)</div>

                </div>
            </span>
        </h2>

        <div class="card my-3">
            <div class="card-body">
                <div class="card-text" style="white-space: pre-line;">{{ question.content }}</div>
                <img src="{{ question.thumbnail.url }}" alt="{{question.subject}}" class="img-fluid"
                    style="width: 20%;   object-fit: cover;  user-select: auto;">

                <div class="d-flex justify-content-end">
                    {% if question.modify_date %}

                    {% endif %}
                    <div
                        style="padding: 10px; border: 1px solid black; border-radius: 10px; background-color: white; font-size: 15px; display: inline-block;">
                        <img class="card-img-top" src="https://d3j8buaepzkvqi.cloudfront.net/img/1582028088451-2.jpg"
                            style="width: 50px; border-radius: 100%; ">
                        <div style="float: right; font-size: 12px; margin-left: 5px;">
                            <div>{{ question.author.username }}</div>
                            <div>{{ question.create_date }}</div>
                        </div>
                        <div style="margin-left: 100px;">

                            {% if request.user == question.author %}
                            <a href="{% url 'pybo:expert_modify' question.id  %}"
                                class="btn btn-sm btn-outline-secondary">수정</a>
                            <a href="javascript:void(0)" class="delete btn btn-sm btn-outline-secondary"
                                data-uri="{% url 'pybo:expert_delete' question.id  %}">삭제</a>
                            {% endif %}
                        </div>
                    </div>
                </div>

            </div>
        </div>
        <!-- 답변 -->

        <!-- 이미지 -->
        {% if photo %}
        {{photo.image.url}}
        <img src="{{ photo.image.url}}" alt="" height="600">

        <br>
        {% endif %}
        {{photo.image}}
        {% for photo in post.photo_set.all%}
        <!-- <img src="{{photo.image}}" width="50"><br> -->
        {% endfor %}
        <h5 class="border-bottom my-3 py-2">{{question.expert_answers.count}} comment</h5>
        {% for answer in question.expert_answers.all %}
        <a id="answer_{{ answer.id }}"></a>
        <div class="card my-3">
            <div class="card-body">
                <div style="display: inline-block; ">
                    <img class="card-img-top" src="https://d3j8buaepzkvqi.cloudfront.net/img/1582028088451-2.jpg"
                        style="width: 50px; border-radius: 100%; ">

                    <div style="float: right; margin-left: 10px;">{{ answer.author.username }}<br><span>
                            <div>
                                {% if answer.modify_date %}
                                <div style="font-size: 10px; float: right;">
                                    <div>(수정됨)</div>
                                </div>
                                {% endif %}
                                <div>
                                    <div style="font-size: 10px;">{{ answer.create_date }}</div>
                                </div>
                            </div>
                        </span>
                    </div>

                </div>


                <div class="card-text"
                    style="border: 1px solid black; margin-left: 5%; margin-top: 10px; padding: 10px; border-radius: 10px; background-color: white">
                    {{ answer.content }}
                </div>

                <div style="float: right; margin-top: 10px;">
                    {% if request.user == answer.author %}
                    <a href="{% url 'pybo:expert_answer_modify' answer.id  %}"
                        class="btn btn-sm btn-outline-secondary">수정</a>
                    <a href="#" class="delete btn btn-sm btn-outline-secondary "
                        data-uri="{% url 'pybo:expert_answer_delete' answer.id  %}">삭제</a>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
        <!-- 답변 등록 -->
        <form action="{% url 'pybo:expert_answer_create' question.id %}" method="post" class="my-3">
            {% csrf_token %}
            <!-- 오류표시 Start -->
            {% if form.errors %}
            <div class="alert alert-danger" role="alert">
                {% for field in form %}
                {% if field.errors %}
                <div>
                    <strong>{{ field.label }}</strong>
                    {{ field.errors }}
                </div>
                {% endif %}
                {% endfor %}
            </div>
            {% endif %}
            <!-- 오류표시 End -->
            <div class="mb-3">
                <label for="content" class="form-label">답변내용</label>
                <textarea {% if not user.is_authenticated %}disabled{% endif %} name="content" id="content" placeholder="sdfsdfdsf"
                     rows="5" style=" outline-color: #5429FF; padding: 10px; width: 100%; border-radius: 10px; ">
                </textarea>
            </div>
            <input type="submit" value="답변등록" class="btn btn-primary"
                style="padding:8px; color: white; background-color: #5429FF; border: none; float: right; width: 100px;">
        </form>
    </div>
</div>
<style>
</style>
{% endblock %}
{% block script %}
<script type='text/javascript'>
    const delete_elements = document.getElementsByClassName("delete");
    Array.from(delete_elements).forEach(function (element) {
        element.addEventListener('click', function () {
            if (confirm("정말로 삭제하시겠습니까?")) {
                location.href = this.dataset.uri;
            };
        });
    });
    const recommend_elements = document.getElementsByClassName("recommend");
    Array.from(recommend_elements).forEach(function (element) {
        element.addEventListener('click', function () {
            if (confirm("정말로 추천하시겠습니까?")) {
                location.href = this.dataset.uri;
            };
        });
    });
</script>

{% endblock %}